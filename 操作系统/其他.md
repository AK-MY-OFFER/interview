# 其他

## 问题

* 谈谈用户态内核态

* 谈谈宏内核和微内核

* ubuntu开机的时候系统做了什么？

* 什么是实时操作系统

* 实模式和保护模式区别

	



## 回答

#### 谈谈用户态内核态

**为什么要分内核态和用户态**

为了安全性。在cpu的一些指令中，有的指令如果用错，将会导致整个系统崩溃。分了内核态和用户态后，当用户需要操作这些指令时候，内核为其提供了API，可以通过系统调用陷入内核，让内核去执行这些操作。



**用户态和内核态区别**

用户态和内核态是操作系统的两种运行级别，两者最大的区别就是**特权级不同**。用户态拥有最低的特权级，内核态拥有较高的特权级。运行在用户态的程序不能直接访问操作系统内核数据结构和程序。内核态和用户态之间的转换方式主要包括：**系统调用，异常和中断。**



**请你来说一说用户态到内核态的转化原理**

1）用户态切换到内核态的3种方式

1. 系统调用

	这是用户进程主动要求切换到内核态的一种方式，用户进程通过系统调用申请操作系统提供的服务程序完成工作。而系统调用的机制其核心还是使用了操作系统为用户特别开放的一个中断来实现，例如Linux的ine 80h中断。系统调用是操作系统的最小功能单位，是操作系统提供的用户接口，系统调用本身是一种**软中断**。

2. 异常

	异常，也叫做内中断。当CPU在执行运行在用户态的程序时，发现了某些事件不可知的异常，这是会触发由当前运行进程切换到处理此。异常的内核相关程序中，也就到了内核态，比如**缺页异常**。

3. 外围设备的中断

	硬中断，当外围设备完成用户请求的操作之后，会向CPU发出相应的中断信号，这时CPU会暂停执行下一条将要执行的指令，转而去执行中断信号的处理程序，如果先执行的指令是用户态下的程序，那么这个转换的过程自然也就发生了有用户态到内核态的切换。比**如硬盘读写操作完成**，系统会切换到硬盘读写的中断处理程序中执行后续操作等。

2）切换操作

从出发方式看，可以在认为存在前述3种不同的类型，但是从最终实际完成由用户态到内核态的切换操作上来说，涉及的关键步骤是完全一样的，没有任何区别，都相当于执行了一个中断响应的过程，**因为系统调用实际上最终是中断机制实现的**，而异常和中断处理机制基本上是一样的，用户态切换到内核态的步骤主要包括：

1. 从当前进程的描述符中提取其内核栈的ss0及esp0信息。

2. **使用ss0和esp0指向的内核栈将当前进程的cs,eip，eflags，ss,esp信息保存起来**，这个过程也完成了**由用户栈找到内核栈**的切换过程，同时保存了被暂停执行的程序的下一条指令。

3. 将先前由中断向量检索得到的中断处理程序的cs，eip信息装入相应的寄存器，开始执行**中断处理程序**，这时就转到了内核态的程序执行了。

#### 谈谈宏内核和微内核

**宏内核：**

除了最基本的进程、线程管理、内存管理外，将文件系统，驱动，网络协议等等都集成在内核里面，例如linux内核。
优点：效率高。

缺点：稳定性差，开发过程中的bug经常会导致整个系统挂掉。

**微内核：**

内核中只有最基本的调度、内存管理。驱动、文件系统等都是用户态的守护进程去实现的。

优点：稳定，驱动等的错误只会导致相应进程死掉，不会导致整个系统都崩溃

缺点：效率低。典型代表QNX，QNX的文件系统是跑在用户态的进程，称为resmgr的东西，是订阅发布机制，文件系统的错误只会导致这个守护进程挂掉。不过数据吞吐量就比较不乐观了。



### ubuntu开机的时候系统做了什么

1）加载BIOS

​	    因为ROM的发明，开机程序会被刷入ROM中。当计算机通电的时候，首先读取ROM。

​		ROM里面的程序叫做**基本输入输出系统（BIOS）**

​		BIOS首先“硬件自检”，查看硬件是否能够工作。完成后BIOS把权限交给启动程序，用来对启动设备进行排序，依次启动

2）读取MBR

​		BIOS首先把控制权交给存储设备。系统会读取该设备的最前面512字节，如果最后两个字节分别是0x55和0xAA则表示可以启动，然后把控制权交给下一个设备

​		存储设备最前面的512个叫做**主引导记录（MBR）**，由三部分组成：

​				①1-446字节，调用操作系统的机器码

​				②447-510字节，分区表

​				③511-512字节，主引导记录签名（0x55和0xAA）

3）Bootloader

​		 Boot Loader 就是在操作系统内核运行之前运行的一段小程序。通过这段小程序，我们可以初始化硬件设备、建立内存空间的映射图，从而将系统的软硬件环境带到一个合适的状态，以便为最终调用操作系统内核做好一切准备。Boot Loader有若干种，其中Grub、Lilo和spfdisk是常见的Loader。Linux环境中，目前最流行的启动管理器是 Grub。

4）加载内核

​		内核加载后，接开始操作系统初始化，根据进程的优先级启动进程，这时候linux操作系统已经可以运行了

5）用户层init依据inittab文件来设定运行等级

​		<img src="https://s2.loli.net/2022/01/18/Fg8kXYQtSjJ6uVx.png" alt="img" style="zoom: 80%;" />



#### 什么是实时操作系统

实时操作系统（Real-time operating system, RTOS），又称即时操作系统，它会按照排序运行、管理系统资源，并为开发应用程序提供一致的基础。 实时操作系统与一般的操作系统相比，最大的特色就是“实时性”，如果有一个任务需要执行，实时操作系统会马上（在较短时间内）执行该任务，不会有较长的延时。这种特性保证了各个任务的及时执行。



#### 实模式和保护模式区别